name: Release resource pack

on:
  workflow_dispatch:

jobs:
  prepare_to_send_zip:
    runs-on: ubuntu-latest
    outputs:
      zip_name: ${{ steps.zip_name.outputs.zip_name }}

    steps:
      - uses: actions/checkout@v2

      - name: Set versions
        id: versions
        run: |
          OLD_VERSION=$(grep -o -m 1 -E "(v[0-9]+\.){1}[0-9]+(\.[0-9]+)?" pack.mcmeta)
          echo ::set-output name=old_version::$OLD_VERSION
          echo "Old Version: $OLD_VERSION"
          NEW_VERSION=$(grep -o -m 1 -E "(v[0-9]+\.){1}[0-9]+(\.[0-9]+)?" UpdatedLog.md)
          echo ::set-output name=new_version::$NEW_VERSION
          echo "New Version: $NEW_VERSION"

      - name: Update version of pack.mcmeta
        run: sed -i -r "s/(v[0-9]+\.){1}[0-9]+(\.[0-9]+)?/${{ steps.versions.outputs.new_version }}/" pack.mcmeta

      # - name: Commit and push changes
      #   run: |
      #     git config --local user.email "github-actions[bot]@users.noreply.github.com"
      #     git config --local user.name "github-actions[bot]"

      #     git add -A
      #     git commit -m "[Bump] ${{ steps.versions.outputs.old_version }} -> ${{ steps.versions.outputs.new_version }}"
      #     git push origin HEAD

      - name: Set zip file name
        id: zip_name
        run: |
          ZIP_NAME=$(echo "seichi_tex_${{ steps.versions.outputs.new_version }}.zip")
          echo ::set-output name=zip_name::$ZIP_NAME
          echo "Zip file name: $ZIP_NAME"

      - name: Make zip
        run: zip -r ${{ steps.zip_name.outputs.zip_name }} *

      - uses: actions/upload-artifact@v2
        with:
          name: zip_file
          path: ${{ steps.zip_name.outputs.zip_name }}

  send_zip:
    runs-on: ubuntu-latest
    needs: prepare_to_send_zip

    steps:
      - uses: actions/download-artifact@v2
        with:
          name: zip_file

      - name: Send zip to server
        run: echo "Unimplemnted."

  make_github_release:
    runs-on: ubuntu-latest
    needs: prepare_to_send_zip

    steps:
      - uses: actions/checkout@v2

      - uses: actions/download-artifact@v2
        with:
          name: zip_file

      - run: ls
